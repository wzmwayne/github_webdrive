<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub äº‘ç›˜</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 8px; padding: 20px; }
        h1 { color: #333; margin-bottom: 20px; }
        .breadcrumb { margin-bottom: 20px; color: #666; }
        .breadcrumb span { cursor: pointer; color: #1976d2; }
        .breadcrumb span:hover { text-decoration: underline; }
        .file-list { }
        .file-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; }
        .file-item:hover { background: #f9f9f9; }
        .file-icon { font-size: 24px; margin-right: 12px; }
        .file-name { flex: 1; }
        .file-size { color: #888; font-size: 0.9em; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; color: white; font-size: 0.9em; }
        .btn-open { background: #4caf50; }
        .btn-download { background: #1976d2; }
        .empty { text-align: center; color: #888; padding: 40px; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>â˜ï¸ GitHub äº‘ç›˜</h1>
        <div class="breadcrumb" id="breadcrumb">ğŸ  æ ¹ç›®å½•</div>
        <div class="file-list" id="fileList">åŠ è½½ä¸­...</div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let allFiles = [];
        let currentPath = '';
        
        // é…ç½®
        const FILES_INF_PATH = 'files.inf';
        const GITHUB_RAW = 'https://raw.githubusercontent.com';
        
        // è·å–ä»“åº“å
        function getRepoName() {
            const match = window.location.pathname.match(/\/([^\/]+\/[^\/]+)\//);
            return match ? match[1] : '';
        }
        
        // åŠ è½½æ–‡ä»¶åˆ—è¡¨
        async function loadFiles() {
            try {
                const response = await fetch(FILES_INF_PATH);
                if (!response.ok) throw new Error('åŠ è½½å¤±è´¥: ' + response.status);
                const text = await response.text();
                parseFiles(text);
                renderFiles();
            } catch (error) {
                document.getElementById('fileList').innerHTML = `<div class="error">âš ï¸ ${error.message}</div>`;
            }
        }
        
        // è§£ææ–‡ä»¶
        function parseFiles(text) {
            allFiles = [];
            const lines = text.split('\n');
            
            for (let line of lines) {
                line = line.trim();
                if (!line || line.startsWith('#')) continue;
                
                const parts = line.split('|');
                if (parts.length >= 3) {
                    allFiles.push({
                        path: parts[0].trim(),
                        name: parts[1].trim(),
                        type: parts[2].trim(),
                        size: parts[3] ? parts[3].trim() : '0'
                    });
                }
            }
            
            console.log('è§£æå®Œæˆï¼Œå…±', allFiles.length, 'ä¸ªæ–‡ä»¶');
            console.log('æ–‡ä»¶åˆ—è¡¨:', allFiles);
        }
        
        // è·å–å½“å‰ç›®å½•çš„æ–‡ä»¶
        function getCurrentDirFiles() {
            const result = [];
            
            for (let file of allFiles) {
                let filePath = file.path;
                
                // ç¡®ä¿ç›®å½•è·¯å¾„ä»¥ / ç»“å°¾
                if (file.type === 'dir' && !filePath.endsWith('/')) {
                    filePath = filePath + '/';
                }
                
                // æ£€æŸ¥æ˜¯å¦åœ¨å½“å‰ç›®å½•ä¸‹
                if (!filePath.startsWith(currentPath)) continue;
                
                // è·å–ç›¸å¯¹è·¯å¾„
                const relativePath = filePath.slice(currentPath.length);
                
                // è·³è¿‡å½“å‰ç›®å½•æœ¬èº«
                if (!relativePath) continue;
                
                // åªæ˜¾ç¤ºç›´æ¥å­é¡¹ï¼ˆä¸åŒ…å« /ï¼‰
                if (!relativePath.includes('/')) {
                    result.push({
                        ...file,
                        path: filePath
                    });
                }
            }
            
            // æ’åºï¼šæ–‡ä»¶å¤¹åœ¨å‰
            result.sort((a, b) => {
                if (a.type === 'dir' && b.type !== 'dir') return -1;
                if (a.type !== 'dir' && b.type === 'dir') return 1;
                return a.name.localeCompare(b.name);
            });
            
            console.log('å½“å‰ç›®å½•:', currentPath, 'æ–‡ä»¶æ•°:', result.length);
            return result;
        }
        
        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
        function renderFiles() {
            const files = getCurrentDirFiles();
            const fileList = document.getElementById('fileList');
            
            // æ›´æ–°é¢åŒ…å±‘
            updateBreadcrumb();
            
            if (files.length === 0) {
                fileList.innerHTML = '<div class="empty">ğŸ“­ æ­¤ç›®å½•ä¸ºç©º</div>';
                return;
            }
            
            let html = '';
            for (let file of files) {
                const icon = file.type === 'dir' ? 'ğŸ“' : 'ğŸ“„';
                const size = file.type === 'dir' ? 'æ–‡ä»¶å¤¹' : formatSize(file.size);
                const btnClass = file.type === 'dir' ? 'btn-open' : 'btn-download';
                const btnText = file.type === 'dir' ? 'æ‰“å¼€' : 'ä¸‹è½½';
                
                html += `
                    <div class="file-item" onclick="openItem('${file.path}', '${file.type}')">
                        <span class="file-icon">${icon}</span>
                        <span class="file-name">${file.name}</span>
                        <span class="file-size">${size}</span>
                        <button class="btn ${btnClass}">${btnText}</button>
                    </div>
                `;
            }
            
            fileList.innerHTML = html;
        }
        
        // æ›´æ–°é¢åŒ…å±‘
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            const parts = currentPath.split('/').filter(p => p);
            
            let html = '<span onclick="goToPath(\'\')">ğŸ  æ ¹ç›®å½•</span>';
            let pathAccum = '';
            
            for (let part of parts) {
                pathAccum += part + '/';
                html += ` / <span onclick="goToPath('${pathAccum}')">${part}</span>`;
            }
            
            breadcrumb.innerHTML = html;
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatSize(bytes) {
            if (!bytes || bytes === '0') return '0 B';
            const num = parseInt(bytes);
            if (isNaN(num)) return '0 B';
            if (num < 1024) return num + ' B';
            if (num < 1048576) return (num / 1024).toFixed(1) + ' KB';
            return (num / 1048576).toFixed(1) + ' MB';
        }
        
        // è·³è½¬åˆ°æŒ‡å®šè·¯å¾„
        function goToPath(path) {
            currentPath = path;
            renderFiles();
        }
        
        // æ‰“å¼€é¡¹ç›®
        function openItem(path, type) {
            if (type === 'dir') {
                currentPath = path.endsWith('/') ? path : path + '/';
                renderFiles();
            } else {
                const repo = getRepoName();
                const url = `${GITHUB_RAW}/${repo}/main/${path}`;
                console.log('ä¸‹è½½é“¾æ¥:', url);
                window.open(url, '_blank');
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', loadFiles);
    </script>
</body>
</html>
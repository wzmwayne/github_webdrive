<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub ‰∫ëÁõò</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #fafafa;
        }
        .header h1 {
            font-size: 1.5em;
            color: #333;
        }
        .breadcrumb {
            padding: 10px 20px;
            background: #f9f9f9;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
        }
        .breadcrumb-item {
            cursor: pointer;
            color: #1976d2;
            text-decoration: none;
        }
        .breadcrumb-item:hover { text-decoration: underline; }
        .file-list { padding: 0; }
        .file-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }
        .file-item:hover { background: #f5f5f5; }
        .file-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 1.2em;
        }
        .file-info { flex: 1; }
        .file-name {
            font-size: 1em;
            color: #333;
            margin-bottom: 2px;
        }
        .file-meta {
            font-size: 0.8em;
            color: #888;
        }
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            text-decoration: none;
        }
        .btn-download {
            background: #1976d2;
            color: white;
        }
        .btn-open {
            background: #4caf50;
            color: white;
        }
        .empty-state {
            padding: 40px 20px;
            text-align: center;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚òÅÔ∏è GitHub ‰∫ëÁõò</h1>
        </div>
        <div class="breadcrumb" id="breadcrumb"></div>
        <div class="file-list" id="fileList"></div>
    </div>

    <script>
        const FILES_INF_PATH = 'files.inf';
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com';
        const CURRENT_REPO = window.location.pathname.match(/\/([^/]+\/[^/]+)\//)?.[1] || '';

        let currentPath = 'files/';
        let fileData = null;

        async function loadFilesInf() {
            try {
                const response = await fetch(FILES_INF_PATH);
                if (!response.ok) throw new Error('Êó†Ê≥ïÂä†ËΩΩÊñá‰ª∂ÂàóË°®');
                const text = await response.text();
                return parseFilesInf(text);
            } catch (error) {
                console.error('Âä†ËΩΩÂ§±Ë¥•:', error);
                return null;
            }
        }

        function parseFilesInf(text) {
            const files = [];
            const lines = text.split('\n').filter(line => line.trim() && !line.trim().startsWith('#'));
            for (const line of lines) {
                const parts = line.split('|').map(p => p.trim());
                if (parts.length >= 3) {
                    files.push({
                        path: parts[0],
                        name: parts[1],
                        type: parts[2],
                        size: parts[3] || '0',
                        updated: parts[4] || new Date().toISOString()
                    });
                }
            }
            return files;
        }

        function getCurrentFiles() {
            if (!fileData) return [];
            const normalizedCurrentPath = currentPath.replace(/\/$/, '') + '/';
            return fileData.filter(file => {
                const filePath = file.path;
                if (!filePath.startsWith(normalizedCurrentPath)) return false;
                const relativePath = filePath.slice(normalizedCurrentPath.length);
                if (!relativePath) return false;
                return !relativePath.includes('/');
            });
        }

        function formatSize(bytes) {
            if (!bytes || bytes === '0') return '0 B';
            const num = parseInt(bytes);
            if (isNaN(num)) return '0 B';
            if (num < 1024) return num + ' B';
            if (num < 1048576) return (num / 1024).toFixed(1) + ' KB';
            return (num / 1048576).toFixed(1) + ' MB';
        }

        function renderBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            const parts = currentPath.split('/').filter(p => p);
            let html = '<span class="breadcrumb-item" onclick="goPath(\'\')">üè†</span>';
            let pathAccum = '';
            for (const part of parts) {
                pathAccum += part + '/';
                html += ` / <span class="breadcrumb-item" onclick="goPath('${pathAccum}')">${part}</span>`;
            }
            breadcrumb.innerHTML = html;
        }

        function renderFileList() {
            const fileList = document.getElementById('fileList');
            const files = getCurrentFiles();
            
            renderBreadcrumb();
            
            if (files.length === 0) {
                fileList.innerHTML = '<div class="empty-state">üì≠ Ê≠§ÁõÆÂΩï‰∏∫Á©∫</div>';
                return;
            }
            
            files.sort((a, b) => {
                if (a.type === 'dir' && b.type !== 'dir') return -1;
                if (a.type !== 'dir' && b.type === 'dir') return 1;
                return a.name.localeCompare(b.name);
            });
            
            let html = '';
            for (const file of files) {
                const icon = file.type === 'dir' ? 'üìÅ' : 'üìÑ';
                html += `
                    <div class="file-item" onclick="handleClick('${file.path}', '${file.type}')">
                        <div class="file-icon">${icon}</div>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">${file.type === 'dir' ? 'Êñá‰ª∂Â§π' : formatSize(file.size)}</div>
                        </div>
                        ${file.type === 'dir' 
                            ? `<button class="btn btn-open">ÊâìÂºÄ</button>`
                            : `<button class="btn btn-download">‰∏ãËΩΩ</button>`
                        }
                    </div>
                `;
            }
            fileList.innerHTML = html;
        }

        function goPath(path) {
            if (!path) path = 'files/';
            currentPath = path;
            renderFileList();
        }

        function handleClick(path, type) {
            if (type === 'dir') {
                currentPath = path.endsWith('/') ? path : path + '/';
                renderFileList();
            } else {
                const url = `${GITHUB_RAW_BASE}/${CURRENT_REPO}/main/${path}`;
                window.open(url, '_blank');
            }
        }

        async function init() {
            fileData = await loadFilesInf();
            if (!fileData) {
                document.getElementById('fileList').innerHTML = '<div class="empty-state">‚ö†Ô∏è Âä†ËΩΩÂ§±Ë¥•</div>';
                return;
            }
            renderFileList();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub äº‘ç›˜</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .header { padding: 20px; border-bottom: 1px solid #e0e0e0; background: #fafafa; }
        .header h1 { font-size: 1.5em; color: #333; }
        .breadcrumb { padding: 10px 20px; background: #f9f9f9; border-bottom: 1px solid #e0e0e0; font-size: 0.9em; }
        .breadcrumb-item { cursor: pointer; color: #1976d2; text-decoration: none; }
        .breadcrumb-item:hover { text-decoration: underline; }
        .file-list { padding: 0; }
        .file-item { display: flex; align-items: center; padding: 12px 20px; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
        .file-item:hover { background: #f5f5f5; }
        .file-icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 1.2em; }
        .file-info { flex: 1; }
        .file-name { font-size: 1em; color: #333; margin-bottom: 2px; }
        .file-meta { font-size: 0.8em; color: #888; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; text-decoration: none; }
        .btn-download { background: #1976d2; color: white; }
        .btn-open { background: #4caf50; color: white; }
        .empty-state { padding: 40px 20px; text-align: center; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>â˜ï¸ GitHub äº‘ç›˜</h1>
        </div>
        <div class="breadcrumb" id="breadcrumb"></div>
        <div class="file-list" id="fileList"></div>
    </div>

    <script>
        const FILES_INF_PATH = 'files.inf';
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com';
        const CURRENT_REPO = window.location.pathname.match(/\/([^/]+\/[^/]+)\/)?.[1] || '';

        let currentPath = '';
        let fileData = null;

        async function loadFilesInf() {
            try {
                const response = await fetch(FILES_INF_PATH);
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½æ–‡ä»¶åˆ—è¡¨');
                const text = await response.text();
                return parseFilesInf(text);
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                return null;
            }
        }

        function parseFilesInf(text) {
            const files = [];
            const lines = text.split('\n').filter(line => line.trim() && !line.trim().startsWith('#'));
            for (const line of lines) {
                const parts = line.split('|').map(p => p.trim());
                if (parts.length >= 3) {
                    // ç¡®ä¿è·¯å¾„ä»¥ / ç»“å°¾ï¼ˆå¦‚æœæ˜¯ç›®å½•ï¼‰
                    let path = parts[0];
                    if (parts[2] === 'dir' && !path.endsWith('/')) {
                        path = path + '/';
                    }
                    files.push({
                        path: path,
                        name: parts[1],
                        type: parts[2],
                        size: parts[3] || '0',
                        updated: parts[4] || new Date().toISOString()
                    });
                }
            }
            return files;
        }

        function getCurrentFiles() {
            if (!fileData) return [];
            
            // å¦‚æœå½“å‰è·¯å¾„ä¸ºç©ºï¼Œæ˜¾ç¤ºæ ¹ç›®å½•ï¼ˆfiles/ï¼‰çš„ç›´æ¥å­é¡¹
            const normalizedCurrentPath = currentPath ? currentPath.replace(/\/$/, '') + '/' : '';
            
            return fileData.filter(file => {
                const filePath = file.path;
                
                // æ£€æŸ¥æ˜¯å¦åœ¨å½“å‰ç›®å½•ä¸‹
                if (!filePath.startsWith(normalizedCurrentPath)) return false;
                
                // è·å–ç›¸å¯¹è·¯å¾„
                const relativePath = filePath.slice(normalizedCurrentPath.length);
                
                // å¦‚æœæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè¯´æ˜æ˜¯å½“å‰ç›®å½•æœ¬èº«ï¼Œè·³è¿‡
                if (!relativePath) return false;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯ç›´æ¥å­é¡¹ï¼ˆä¸åŒ…å« /ï¼‰
                return !relativePath.includes('/');
            });
        }

        function formatSize(bytes) {
            if (!bytes || bytes === '0') return '0 B';
            const num = parseInt(bytes);
            if (isNaN(num)) return '0 B';
            if (num < 1024) return num + ' B';
            if (num < 1048576) return (num / 1024).toFixed(1) + ' KB';
            return (num / 1048576).toFixed(1) + ' MB';
        }

        function renderBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            const parts = currentPath.split('/').filter(p => p);
            let html = '<span class="breadcrumb-item" onclick="goPath(\'\')">ğŸ </span>';
            let pathAccum = '';
            for (const part of parts) {
                pathAccum += part + '/';
                html += ` / <span class="breadcrumb-item" onclick="goPath('${pathAccum}')">${part}</span>`;
            }
            breadcrumb.innerHTML = html;
        }

        function renderFileList() {
            const fileList = document.getElementById('fileList');
            const files = getCurrentFiles();
            
            renderBreadcrumb();
            
            if (files.length === 0) {
                fileList.innerHTML = '<div class="empty-state">ğŸ“­ æ­¤ç›®å½•ä¸ºç©º</div>';
                return;
            }
            
            files.sort((a, b) => {
                if (a.type === 'dir' && b.type !== 'dir') return -1;
                if (a.type !== 'dir' && b.type === 'dir') return 1;
                return a.name.localeCompare(b.name);
            });
            
            let html = '';
            for (const file of files) {
                const icon = file.type === 'dir' ? 'ğŸ“' : 'ğŸ“„';
                html += `
                    <div class="file-item" onclick="handleClick('${file.path}', '${file.type}')">
                        <div class="file-icon">${icon}</div>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">${file.type === 'dir' ? 'æ–‡ä»¶å¤¹' : formatSize(file.size)}</div>
                        </div>
                        ${file.type === 'dir' 
                            ? `<button class="btn btn-open">æ‰“å¼€</button>`
                            : `<button class="btn btn-download">ä¸‹è½½</button>`
                        }
                    </div>
                `;
            }
            fileList.innerHTML = html;
        }

        function goPath(path) {
            currentPath = path;
            renderFileList();
        }

        function handleClick(path, type) {
            if (type === 'dir') {
                currentPath = path.endsWith('/') ? path : path + '/';
                renderFileList();
            } else {
                const url = `${GITHUB_RAW_BASE}/${CURRENT_REPO}/main/${path}`;
                window.open(url, '_blank');
            }
        }

        async function init() {
            fileData = await loadFilesInf();
            if (!fileData) {
                document.getElementById('fileList').innerHTML = '<div class="empty-state">âš ï¸ åŠ è½½å¤±è´¥</div>';
                return;
            }
            // ä»æ ¹ç›®å½•å¼€å§‹æ˜¾ç¤º
            currentPath = '';
            renderFileList();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>